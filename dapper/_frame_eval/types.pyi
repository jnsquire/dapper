import contextvars
from types import CodeType
from types import FrameType
from typing import Any

from typing_extensions import TypeAlias

FrameStats: TypeAlias = dict[str, int | float | bool]
BreakpointLines: TypeAlias = set[int]

class _FrameEvalModuleState:
    active: bool
    thread_info_var: contextvars.ContextVar[ThreadInfo | None]

    def enable(self) -> None: ...
    def disable(self) -> None: ...
    def get_thread_info(self) -> ThreadInfo: ...
    def clear_thread_local_info(self) -> None: ...
    def get_stats(self) -> FrameStats: ...

_state: _FrameEvalModuleState

class ThreadInfo:
    inside_frame_eval: int
    fully_initialized: bool
    is_pydevd_thread: bool
    thread_trace_func: Any | None
    additional_info: Any | None
    recursion_depth: int
    skip_all_frames: bool

    def __init__(self) -> None: ...
    def enter_frame_eval(self) -> None: ...
    def exit_frame_eval(self) -> None: ...
    def should_skip_frame(self, frame: FrameType) -> bool: ...

class FuncCodeInfo:
    co_filename: bytes
    real_path: str
    always_skip_code: bool
    breakpoint_found: bool
    new_code: CodeType | None
    breakpoints_mtime: float
    breakpoint_lines: BreakpointLines
    last_check_time: float
    is_valid: bool

    def __init__(self) -> None: ...
    def update_breakpoint_info(self, code_obj: CodeType) -> None: ...

def get_func_code_info(frame_obj: FrameType, code_obj: CodeType) -> FuncCodeInfo: ...

# Backward-compatible convenience aliases that delegate to _state
def get_thread_info() -> ThreadInfo: ...
def frame_eval_func() -> None: ...
def stop_frame_eval() -> None: ...
def clear_thread_local_info() -> None: ...
def get_frame_eval_stats() -> FrameStats: ...
def mark_thread_as_pydevd() -> None: ...
def unmark_thread_as_pydevd() -> None: ...
def set_thread_skip_all(skip: bool) -> None: ...
